name: Performance Test (pytest-benchmark)

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  benchmark:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.12"]    

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.12"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        python -m pip install pytest pytest-benchmark
        if [ -f requirements.txt ]; then python -m pip install -r requirements.txt; fi

    - name: Run benchmarks and export JSON
      env:
        PYTHONPATH: src
      run: |
        pytest -q tests/test_benchmark_calculator.py \
        --benchmark-only \
        --benchmark-json benchmark.json

    - name: Upload benchmark report
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: benchmark-json
        path: benchmark.json
        if-no-files-found: error
